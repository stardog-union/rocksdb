load("//:rocksdb.bzl", "constrained_library", "constrained_test")

cc_library(
    name = "table",
    srcs = glob(["*.cc"], exclude=["table_reader_bench.cc", "*_test.*", "mock_table.*"]),
    deps = [
        ":headers",
        "//db:headers",
        "//include",
        "//options:headers",
        "//util:headers",
    ],
    visibility = ["//visibility:public"],
)

cc_library(
    name = "headers",
    hdrs = glob(["*.h"], exclude=["*_test.*", "mock_table.*"]),
    deps = [
    ],
    visibility = ["//visibility:public"],
)

constrained_library(
    name = "test_utils",
    hdrs = glob(["mock_table.h"]),
    srcs = glob(["mock_table.cc"]),
    deps = [
        "//memtable:headers",
        "//options",
        "//util:test_utils",
    ],
    visibility = ["//visibility:public"],
)

constrained_test(
    name = "block_based_filter_block_test",
    srcs = ["block_based_filter_block_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "block_test",
    srcs = ["block_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "cleanable_test",
    srcs = ["cleanable_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "cuckoo_table_builder_test",
    srcs = ["cuckoo_table_builder_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "cuckoo_table_reader_test",
    srcs = ["cuckoo_table_reader_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "full_filter_block_test",
    srcs = ["full_filter_block_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "merger_test",
    srcs = ["merger_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "partitioned_filter_block_test",
    srcs = ["partitioned_filter_block_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "table_test",
    srcs = ["table_test.cc"],
    deps = [
        ":table",
        ":test_utils",
        "//cache",
        "//db",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)
