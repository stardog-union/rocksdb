load("//:rocksdb.bzl", "constrained_library", "constrained_test")

EXCLUDED_FILES = [
    "c.cc",
    "forward_iterator_bench.cc",
    "range_del_aggregator_bench.cc",
]

cc_library(
    name = "db",
    srcs = glob(["*.cc"], exclude=["*_test.cc", "*_test2.cc", "*_test_util.cc"] + EXCLUDED_FILES),
    deps = [
        ":headers",
    ],
    visibility = ["//visibility:public"],
    alwayslink = 1,
)

cc_library(
    name = "headers",
    hdrs = glob(["*.h"]),
    deps = [
        "//env:headers",
        "//include",
        "//include:with_extra_prefix",
        "//memtable:headers",
        "//monitoring:headers",
        "//options:headers",
        "//port:headers",
        "//table:headers",
        "//tools:headers",
        "//util:headers",
        "//utilities:headers",
    ],
    visibility = ["//visibility:public"],
)

constrained_library(
    name = "test_utils",
    hdrs = ["db_test_util.h"],
    srcs = ["db_test_util.cc"],
    deps = [
        ":headers",
        "//env",
        "//env:test_utils",
        "//table:test_utils",
    ],
    visibility = ["//visibility:public"],
)

constrained_test(
    name = "column_family_test",
    srcs = ["column_family_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    tags = ["manual"],
    timeout = "eternal",
)

constrained_test(
    name = "compact_files_test",
    srcs = ["compact_files_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "compaction_iterator_test",
    srcs = ["compaction_iterator_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "compaction_job_stats_test",
    srcs = ["compaction_job_stats_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "compaction_job_test",
    srcs = ["compaction_job_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "compaction_picker_test",
    srcs = ["compaction_picker_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "comparator_db_test",
    srcs = ["comparator_db_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "corruption_test",
    srcs = ["corruption_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "cuckoo_table_db_test",
    srcs = ["cuckoo_table_db_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_basic_test",
    srcs = ["db_basic_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_blob_index_test",
    srcs = ["db_blob_index_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_block_cache_test",
    srcs = ["db_block_cache_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_bloom_filter_test",
    srcs = ["db_bloom_filter_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_compaction_filter_test",
    srcs = ["db_compaction_filter_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_compaction_test",
    srcs = ["db_compaction_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    timeout = "long",
)

constrained_test(
    name = "db_dynamic_level_test",
    srcs = ["db_dynamic_level_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_encryption_test",
    srcs = ["db_encryption_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_flush_test",
    srcs = ["db_flush_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_inplace_update_test",
    srcs = ["db_inplace_update_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_io_failure_test",
    srcs = ["db_io_failure_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_iter_test",
    srcs = ["db_iter_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_iterator_test",
    srcs = ["db_iterator_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_log_iter_test",
    srcs = ["db_log_iter_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_memtable_test",
    srcs = ["db_memtable_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_merge_operator_test",
    srcs = ["db_merge_operator_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_options_test",
    srcs = ["db_options_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_properties_test",
    srcs = ["db_properties_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_range_del_test",
    srcs = ["db_range_del_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_sst_test",
    srcs = ["db_sst_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    tags = ["manual"],
    timeout = "eternal",
)

constrained_test(
    name = "db_statistics_test",
    srcs = ["db_statistics_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_table_properties_test",
    srcs = ["db_table_properties_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/table_properties_collectors",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_tailing_iter_test",
    srcs = ["db_tailing_iter_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_test",
    srcs = ["db_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    tags = ["manual"],
    timeout = "eternal",
)

constrained_test(
    name = "db_universal_compaction_test",
    srcs = ["db_universal_compaction_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    timeout = "long",
)

constrained_test(
    name = "db_wal_test",
    srcs = ["db_wal_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "db_write_test",
    srcs = ["db_write_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "dbformat_test",
    srcs = ["dbformat_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "deletefile_test",
    srcs = ["deletefile_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "external_sst_file_basic_test",
    srcs = ["external_sst_file_basic_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "external_sst_file_test",
    srcs = ["external_sst_file_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    tags = ["manual"],
    timeout = "eternal",
)

constrained_test(
    name = "fault_injection_test",
    srcs = ["fault_injection_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "file_indexer_test",
    srcs = ["file_indexer_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "filename_test",
    srcs = ["filename_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "flush_job_test",
    srcs = ["flush_job_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "listener_test",
    srcs = ["listener_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "log_test",
    srcs = ["log_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "manual_compaction_test",
    srcs = ["manual_compaction_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "memtable_list_test",
    srcs = ["memtable_list_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "merge_helper_test",
    srcs = ["merge_helper_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "merge_test",
    srcs = ["merge_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "options_file_test",
    srcs = ["options_file_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "perf_context_test",
    srcs = ["perf_context_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "plain_table_db_test",
    srcs = ["plain_table_db_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "prefix_test",
    srcs = ["prefix_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "range_del_aggregator_test",
    srcs = ["range_del_aggregator_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "repair_test",
    srcs = ["repair_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "table_properties_collector_test",
    srcs = ["table_properties_collector_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "version_builder_test",
    srcs = ["version_builder_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "version_edit_test",
    srcs = ["version_edit_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "version_set_test",
    srcs = ["version_set_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "wal_manager_test",
    srcs = ["wal_manager_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "write_batch_test",
    srcs = ["write_batch_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)

constrained_test(
    name = "write_callback_test",
    srcs = ["write_callback_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
    tags = ["manual"],
    timeout = "eternal",
)

constrained_test(
    name = "write_controller_test",
    srcs = ["write_controller_test.cc"],
    deps = [
        ":db",
        ":test_utils",
        "//cache",
        "//env",
        "//memtable",
        "//monitoring",
        "//options",
        "//table",
        "//table:test_utils",
        "//third_party/gtest",
	"//util",
	"//utilities",
	"//utilities/backupable",
	"//utilities/checkpoint",
	"//utilities/leveldb_options",
	"//utilities/merge_operators",
	"//utilities/merge_operators/string_append",
	"//utilities/options",
	"//utilities/transactions",
	"//utilities/ttl",
	"//utilities/write_batch_with_index",
    ],
)
